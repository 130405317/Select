<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.picker.min.css" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
	</head>

	<body>
		<script src="../../js/jquery-2.2.2.min.js "></script>
		<script src="../../js/mui.min.js "></script>
		<script src="../../js/mui.picker.min.js"></script>
		<script src="../../js/mui.poppicker.js"></script>

		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">个人信息</h1>
		</header>
		<div class="mui-content">
			<div class="mui-card" style="margin-bottom: 10px;">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell mui-media">
						<a id="person-message">
							<img class="mui-media-object mui-pull-right" src="../../img/Avatar.jpg">
							<div class="mui-media-body" style="margin-top: 10px;">
								头像
							</div>
						</a>
					</li>
				</ul>
			</div>

			<div class="mui-card">
				<div class="mui-table-view">
					<div class="mui-table-view-cell">
						<span>姓名：</span>
						<span id="sname"></span>
					</div>
					<div class="mui-table-view-cell">
						<a onclick="changeMessage('sex')">
							<span>性别：</span>
							<span id="sex"></span>
						</a>
					</div>
					<div class="mui-table-view-cell">
						<a onclick="changeMessage('s_birthday')">
							<span>出生日期：</span>
							<span id="s_birthday"></span>
						</a>
					</div>
					<div class="mui-table-view-cell">
						<a onclick="changeMessage('phone')">
							<span>电话：</span>
							<span id="phone"></span>
						</a>
					</div>
					<div class="mui-table-view-cell">
						<a onclick="">
							<span>班级：</span>
							<span id="s_class"></span>
						</a>
					</div>
					<div class="mui-table-view-cell">
						<a onclick="">
							<span>绩点：</span>
							<span id="score"></span>
						</a>
					</div>

				</div>
			</div>
			
			<div class="mui-card">
				<ul class="mui-table-view">
					<li class="mui-table-view-cell mui-collapse">
						<a class="mui-navigate-right" href="#">特长：</a>
						<div class="mui-collapse-content">
							<textarea id="spesialty" readonly="readonly" onclick="changeMessage('spesialty')" name="" rows="5" cols=""></textarea>
						</div>
					</li>
					<li class="mui-table-view-cell mui-collapse">
						<a class="mui-navigate-right" href="#">兴趣：</a>
						<div class="mui-collapse-content">
							<textarea id="interest" readonly="readonly" onclick="changeMessage('interest')" name="" rows="5" cols=""></textarea>
						</div>
					</li>
					<li class="mui-table-view-cell mui-collapse">
						<a class="mui-navigate-right" href="#">曾获奖励：</a>
						<div class="mui-collapse-content">
							<textarea id="award" readonly="readonly" onclick="changeMessage('award')" name="" rows="5" cols=""></textarea>
						</div>
					</li>
				</ul>
			</div>

		</div>
	</body>
	<script type="text/javascript">
		var id;
		mui.init({
			swipeBack: true //启用右滑关闭功能
		});
		(function($) {
			$.ready(function() {
				load();
				//setInterval("load() ",1000);//重复执行
			});
		}(mui));

		function load() {
			id = window.location.href.split("=")[1];
			mui.ajax('http://192.168.1.187:8080/Select-H5/student/getStudentById', {
				data: {
					id: id,
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				success: function(data) {
					$("#sname").text(data.S_NAME);
					if(data.S_SEX == "0") {
						$("#sex").text("男");
					} else {
						$("#sex").text("女");
					}
					$("#phone").text(data.PHONE);
					$("#s_class").text("计算机 " + data.S_CLASS + " 班");
					$("#score").text(data.SCORE);
					$("#s_birthday").text(data.S_BIRTHDAY);
					$("#spesialty").text(data.SPECIALTY);
					$("#interest").text(data.INTEREST);
					$("#award").text(data.AWARD);
				},
				error: function(xhr, type, errorThrown) {
					//异常处理；
					mui.toast("数据加载失败！ ");
				}
			});
		}

		function changeMessage(type) {
			switch(type) {
				case "sex":
					{
						setRadio(type);
						break;
					}

				case "phone":
					{
						var phone = $("#phone").text();
						setText(type, "电话", phone);
						break;
					}
				case "s_birthday":
					{
						setDate(type);
						break;
					}
				case "spesialty":
					{
						var url = "change_message.html?id="+id+"&type="+type;
						location.href = url;
						break;
					}
				case "interest":
					{
						var url = "change_message.html?id="+id+"&type="+type;
						location.href = url;
						break;
					}
				case "award":
					{
						var url = "change_message.html?id="+id+"&type="+type;
						location.href = url;
						break;
					}
				default:
					break;
			}
		}

		function setRadio(type) {
			var data;
			if(type == "sex") {
				data = [{ value: '1', text: '女' },
					{ value: '0', text: '男' }
				];
			}

			var picker = new mui.PopPicker();
			picker.setData(data);
			picker.show(function(selectItems) {
				if(type == "sex") {
					updateMessage(type, selectItems[0].value);
				} else {
					updateMessage(type, selectItems[0].text);
				}
			})
		}
		
		function setDate(type) {
			var dtpicker = new mui.DtPicker({
				type: "date", //设置日历初始视图模式 
				beginDate: new Date(1980, 01, 01), //设置开始日期 
				//endDate: new Date(2016, 04, 25), //设置结束日期 
				labels: ['年', '月', '日'], //设置默认标签区域提示语 
			});
			dtpicker.show(function(selectItems) {
				var date = selectItems.y.value + "-" + selectItems.m.value + "-" + selectItems.d.value;
				updateMessage(type, date);
			});
		}

		function setText(type, message, placeholder) {
			mui.prompt('请输入' + message + ":", placeholder, '修改' + message, ['取消', '确定'], function(e) {
				if(e.index == 1) {
					//确定按钮
					updateMessage(type, e.value);
				} else {
					//取消按钮
				}
			})
		}

		//更新教师信息
		function updateMessage(type, message) {
			mui.ajax('http://192.168.1.187:8080/Select-H5/student/updateStudent', {
				data: {
					id: id,
					type: type,
					message: message
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'post', //HTTP请求类型
				timeout: 10000, //超时时间设置为10秒；
				success: function(data) {
					switch(message) {
						case '0':
							$("#" + type).text("男");
							break;
						case '1':
							$("#" + type).text("女");
							break;
						default:
							$("#" + type).text(message);
							break;
					}
				},
				error: function(xhr, type, errorThrown) {
					//异常处理；
					mui.toast("修改失败！ ");
				}
			});
		}
	</script>

</html>